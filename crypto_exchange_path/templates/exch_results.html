{% extends "layout.html" %}


{% block style %}
    <!-- Your custom styles -->
    <link href="{{ url_for('static', filename='css/exch_search.css') }}" rel="stylesheet">
{% endblock style %}


{% block activepage %}
    <div id="navlink-selector" class="d-none" data-active="nav-link-exchanges"></div>
{% endblock activepage %}


{% block main %}

    {% include '_search_canvas.html' %}

    <!-- Variable to store promotions that have been displayed and must not to be displayed again. -->
    {% set promotions_displayed = [] %}

    <!--Section: Results-->
    <section id="results" data-auto-search={{auto_search}}>

        <div class="container">
            <div class="row no-gutters d-flex justify-content-center py-3 py-sm-4">
                <div class="col-12 col-md-10 col-lg-9 col-xl-8 px-1 px-md-0">

                    {% if paths %}



                        <!-- SEARCH SUMMARY -->
                        <div class="search-summary d-inline-block d-flex align-items-start justify-content-center mb-3 mb-lg-4">
                            <div id="remove-dec" class="font-weight-bold">{{ paths[0].origin.amount }}</div>
                            <div class="d-sm-none d-flex flex-column align-items-center ml-2">
                                <div class="font-weight-bold text-center">{{ paths[0].origin.coin.long_name }}</div>
                                <div class="grey-color smaller-font font-italic">{{ paths[0].origin.exchange.name }}</div>
                            </div>
                            <div class="d-none d-sm-inline ml-2 mr-1">
                                <span class="font-weight-bold">{{ paths[0].origin.coin.long_name }}</span>
                                <span class="grey-color smaller-font font-italic">({{ paths[0].origin.exchange.name }})</span>
                            </div>
                            <i class="fas fa-plane mt-1 mt-sm-2 mx-3"></i>
                            <div class="d-sm-none d-flex flex-column align-items-center">
                                <div class="font-weight-bold text-center">{{ paths[0].destination.coin.long_name }}</div>
                                <div class="grey-color smaller-font font-italic">{{ paths[0].destination.exchange.name }}</div>
                            </div>
                            <div class="d-none d-sm-inline ml-2">
                                <span class="font-weight-bold">{{ paths[0].destination.coin.long_name }}</span>
                                <span class="grey-color smaller-font font-italic">({{ paths[0].destination.exchange.name }})</span>
                            </div>
                        </div>
















                        <!-- SEARCH FILTER DROPDOWNS -->
                        <div class="d-inline-block d-flex flex-wrap justify-content-end">

                            <!-- Location dropdown -->
                            <div id="location-selector" class="search-filter dropdown">
                                <a id="LocationDropdown" class="btn btn-dark dropdown-toggle mr-1 mb-1 mb-1" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                    Location
                                </a>
                                <div class="dropdown-menu" aria-labelledby="LocationDropdown">
                                    <form class="px-3 py-2">
                                        <div id="input-orig-loc" class="form-group">
                                            <label class="mb-1" for="orig_loc">Origin location</label>
                                            {% if form.orig_loc.errors %}
                                                {{ form.orig_loc(class="form-control track-filled typeahead is-invalid", type="text", autocomplete="off", spellcheck="false") }}
                                                <div class="invalid-feedback">
                                                    {% for error in form.orig_loc.errors %}
                                                        <span>{{ error }}</span>
                                                    {% endfor %}
                                                </div>
                                            {% else %}
                                                {{ form.orig_loc(class="form-control track-filled typeahead", type="text", placeholder="Location", autocomplete="off", spellcheck="false") }}
                                            {% endif %}
                                        </div>
                                        <div id="input-dest-loc" class="form-group mb-0">
                                            <label class="mb-1" for="dest_loc" style="min-width: 10rem;">Destination location</label>
                                            {% if form.dest_loc.errors %}
                                                {{ form.dest_loc(class="form-control track-filled typeahead is-invalid", type="text", autocomplete="off", spellcheck="false") }}
                                                <div class="invalid-feedback">
                                                    {% for error in form.dest_loc.errors %}
                                                        <span>{{ error }}</span>
                                                    {% endfor %}
                                                </div>
                                            {% else %}
                                                {{ form.dest_loc(class="form-control track-filled typeahead", type="text", placeholder="Location", autocomplete="off", spellcheck="false") }}
                                            {% endif %}
                                        </div>
                                        <!-- <button id="btn-apply" type="button" class="btn btn-deep-orange btn-sm mx-0 mt-3 mb-0">Apply</button> -->
                                  </form>
                                  <div class="dropdown-divider"></div>
                                  <a class="whats-this d-flex justify-content-center align-items-center" href="/blog/page/15#end-to-end-calculation" target="_blank">
                                      <span>What's this?<span>
                                      <i class="fas fa-external-link-alt ml-2"></i>
                                  </a>
                              </div>
                            </div>

                            <!-- Market fee Dropdown -->
                            <div id="market-fee-selector" class="search-filter dropdown">
                                <a class="btn btn-dark dropdown-toggle mr-sm-1 mb-1" href="#" role="button" id="MarketFeeDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                    Market fee
                                </a>
                                <div class="dropdown-menu dropdown-menu-right" aria-labelledby="MarketFeeDropdown">
                                    <table class="table table-borderless table-hover">
                                        <tbody>
                                            <tr data-fee-type="(Taker)">
                                                <th></th>
                                                <td scope="row">Market Taker</td>
                                            </tr>
                                            <tr data-fee-type="(Maker)">
                                                <th></th>
                                                <td scope="row">Market Maker</td>
                                            </tr>
                                            <tr data-fee-type="(Avg)">
                                                <th></th>
                                                <td scope="row">Taker&Maker Average</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                    <div class="dropdown-divider"></div>
                                    <a class="whats-this d-flex justify-content-center align-items-center" href="/blog/page/15#market-taker-fees" target="_blank">
                                        <span>What's this?<span>
                                        <i class="fas fa-external-link-alt ml-2"></i>
                                    </a>
                                </div>
                            </div>

                            <div class="w-100 d-sm-none"><!-- break line on XS screens--></div>

                            <!-- Connections Dropdown -->
                            <div class="search-filter dropdown">
                                <a class="btn btn-dark dropdown-toggle mr-1" href="#" role="button" id="ConnectionsDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                    Connections
                                </a>
                                <div class="dropdown-menu" aria-labelledby="ConnectionsDropdown">
                                    <table class="table table-borderless table-hover">
                                        <tbody>
                                            <tr class="connection-filter" data-connection-type="0">
                                                <th></th>
                                                <td scope="row">Direct exchange</td>
                                            </tr>
                                            <tr class="connection-filter" data-connection-type="1">
                                                <th></th>
                                                <td scope="row">One connection</td>
                                            </tr>
                                            <tr id="connection-filter-default" class="connection-filter" data-connection-type="2">
                                                <th></th>
                                                <td scope="row">Two connections</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                    <div class="dropdown-divider"></div>
                                    <a class="whats-this d-flex justify-content-center align-items-center" href="/blog/page/15#connections" target="_blank">
                                        <span>What's this?<span>
                                        <i class="fas fa-external-link-alt ml-2"></i>
                                    </a>
                                </div>
                            </div>
                            <!-- Exchanges Dropdown -->
                            <div id="exchange-selector" class="search-filter dropdown">
                                <a class="btn btn-dark dropdown-toggle" href="#" role="button" id="ExchangesDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                    Exchanges
                                </a>
                                <div class="dropdown-menu dropdown-menu-right pb-3" aria-labelledby="ExchangesDropdown">
                                    <form>
                                        <div class="h5 font-weight-bold pl-3 mb-1 mt-1" for="orig_loc">Preferred exchanges</div>
                                        <div class="col">
                                            <div class="row">
                                                <div class="col d-flex justify-content-start my-2">
                                                    <button id="select-all-btn" type="button" class="btn btn-deep-orange btn-sm mr-2">Select All</button>
                                                    <button id="deselect-all-btn" type="button" class="btn btn-deep-orange btn-sm">Clear All</button>
                                                </div>
                                            </div>
                                            <div class="row" style="min-width: 20rem;">
                                                {% for exch in exchanges %}
                                                    <div class="col-6">
                                                        <div class="form-check">
                                                            {% if exch.id in user_exchanges %}
                                                                <input type="checkbox" class="form-check-input" id="exch-{{ exch.id }}" checked>
                                                            {% else %}
                                                                <input type="checkbox" class="form-check-input" id="exch-{{ exch.id }}">
                                                            {% endif %}
                                                            <label class="form-check-label" for="exch-{{ exch.id }}">{{ exch.name }}</label>
                                                        </div>
                                                    </div>
                                                {% endfor %}
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>

                        <!-- FILTER BADGES -->
                        <div id="filter-badges" class="d-none">
                            <div class="d-flex justify-content-end align-items-center">
                                <span class="grey-color smaller-font mt-2 mr-1 font-weight-bold font-italic">Applied filters:</span>
                                <div id="filter-badge-exchange" class="badge badge-pill ml-2 mt-2 d-none">
                                    <span>Exchanges</span>
                                    <i class="fas fa-times fa-sm ml-2" data-trigger="select-all-btn"></i>
                                </div>
                                <div id="filter-badge-connections" class="badge badge-pill ml-2 mt-2 d-none">
                                    <span>Connections</span>
                                    <i class="fas fa-times fa-sm ml-2" data-trigger="connection-filter-default"></i>
                                </div>
                            </div>
                        </div>


















                    <div class="row no-gutters mb-1 mt-2">
                        <div class="col-10 pl-3">
                            {% if path_results == 1 %}
                                <div class="">
                                    <span id="results-count"></span>
                                    <span>{{ path_results }} result</span>
                                </div>
                            {% else %}
                                <div class="">
                                    <span id="results-count"></span>
                                    <span>{{ path_results }} Results</span>
                                </div>
                            {% endif %}
                        </div>
                        <div class="col-2 d-flex align-items-center justify-content-center">
                            <span class="detail-header">Fees</span>
                        </div>
                    </div>
                {% elif path_results == -1 %}
                    <h2 class="text-center font-weight-bold font-italic mt-4 mb-2">Ops!!</h2>
                    <div class="d-flex align-items-center">
                        <h5 class="text-center font-weight-bold my-2">Something went wrong when performing that search... <i class="far fa-frown"></i></h5>
                    </div>
                    <h5 class="text-center font-weight-bold my-2">Our tech team has already been notified and will solve it ASAP.</h5>
                    <p class="text-center lead font-weight-bold font-italic mt-4" style="color: #676767">Please, try again latter...</p>
                {% elif path_results == 0 %}
                    <h3 class="text-center font-weight-bold mt-4 mb-3">Ops!!</h3>
                    <h5 class="text-center font-weight-bold my-3">We did not get any result for that search...</h5>
                    <h5 class="text-center font-weight-bold my-3">Please, try again with a less restrictive configuration</h5>
                    <p class="text-center lead font-weight-bold font-italic" style="color: #676767">(most low ranked coins usually need two connections to get results).</p>
                {% endif %}


















                    {% for path in paths %}




                        {% if path.hop_2 %}
                            <div class="result-card card mb-4" data-connection-type="{{ path.type }}" data-exch-1="{{ path.hop_1.exchange.id }}" data-exch-2="{{ path.hop_2.exchange.id }}">
                        {% else %}
                            <div class="result-card card mb-4" data-connection-type="{{ path.type }}" data-exch-1="{{ path.hop_1.exchange.id }}" data-exch-2="">
                        {% endif %}
                            <div class="card-header px-0 pt-3 pb-0">



                                <!-- PATH SUMMARY -->
                                <div class="row no-gutters" style="white-space: nowrap;">

                                    <!-- EXCHANGE 1 SUMMARY -->
                                    <div class="col-5 pl-3">
                                        <!-- Layout for XS to MD devices -->
                                        <div class="d-lg-none">
                                            <div class="d-flex justify-content-start align-items-center">
                                                <img class="img-exchange-lg mr-1" src="/static/img/exchanges/64/{{ path.hop_1.exchange.img_fn }}" alt="{{ path.hop_1.exchange.name }} logo">
                                                <a class="exchange-format" href="{{ path.hop_1.exchange.site_url }}" target="_blank" style="color: #212529">{{ path.hop_1.exchange.name }}</a>
                                            </div>
                                            <div class="d-flex align-items-center mt-3">
                                                <small class="d-flex align-items-center dark-grey-color">
                                                    <img class="mr-1 img-coin" src="/static/img/coins/16/{{ path.hop_1.trade.sell_coin.local_fn }}" alt="{{ path.hop_1.trade.sell_coin.long_name }} logo">
                                                    <span>{{ path.hop_1.trade.sell_coin.symbol }}</span>
                                                    <i class="fas fa-exchange-alt mx-2"></i>
                                                    <img class="mr-1 img-coin" src="/static/img/coins/16/{{ path.hop_1.trade.buy_coin.local_fn }}" alt="{{ path.hop_1.trade.buy_coin.long_name }} logo">
                                                    <span>{{ path.hop_1.trade.buy_coin.symbol }}</span>
                                                    {% if path.hop_2 %}
                                                        {% if path.hop_1.exchange.id == path.hop_2.exchange.id %}
                                                            <i class="fas fa-exchange-alt mx-2"></i>
                                                            <img class="mr-1 img-coin" src="/static/img/coins/16/{{ path.hop_2.trade.buy_coin.local_fn }}" alt="{{ path.hop_2.trade.buy_coin.long_name }} logo">
                                                            <span>{{ path.hop_2.trade.buy_coin.symbol }}</span>
                                                            {% if path.hop_1.exchange.id != path.destination.exchange.id %}
                                                                <i class="fas fa-arrow-right pl-1 pl-sm-2"></i>
                                                            {% endif %}
                                                        {% else %}
                                                            <i class="fas fa-arrow-right pl-1 pl-sm-2"></i>
                                                        {% endif %}
                                                    {% else %}
                                                        {% if path.hop_1.exchange.id != path.destination.exchange.id %}
                                                            <i class="fas fa-arrow-right pl-1 pl-sm-2"></i>
                                                        {% endif %}
                                                    {% endif %}
                                                </small>
                                            </div>
                                        </div>
                                        <!-- Layout for LG+ devices -->
                                        <div class="d-none d-lg-block">
                                            <div class="d-flex align-items-center">
                                                <div class="ml-4">
                                                    <img class="img-exchange-lg" src="/static/img/exchanges/64/{{ path.hop_1.exchange.img_fn }}" alt="{{ path.hop_1.exchange.name }} logo">
                                                </div>
                                                <div class="ml-3">
                                                    <div>
                                                        <a class="exchange-format font-weight-bold" href="{{ path.hop_1.exchange.site_url }}" target="_blank" style="color: #212529">{{ path.hop_1.exchange.name }}</a>
                                                    </div>
                                                    <div class="d-flex align-items-center mt-2">
                                                        <small class="d-flex align-items-center dark-grey-color">
                                                            <img class="mr-1 img-coin" src="/static/img/coins/16/{{ path.hop_1.trade.sell_coin.local_fn }}" alt="{{ path.hop_1.trade.sell_coin.long_name }} logo">
                                                            <span>{{ path.hop_1.trade.sell_coin.symbol }}</span>
                                                            <i class="fas fa-exchange-alt mx-2"></i>
                                                            <img class="mr-1 img-coin" src="/static/img/coins/16/{{ path.hop_1.trade.buy_coin.local_fn }}" alt="{{ path.hop_1.trade.buy_coin.long_name }} logo">
                                                            <span>{{ path.hop_1.trade.buy_coin.symbol }}</span>
                                                            {% if path.hop_2 %}
                                                                {% if path.hop_1.exchange.id == path.hop_2.exchange.id %}
                                                                    <i class="fas fa-exchange-alt mx-2"></i>
                                                                    <img class="mr-1 img-coin" src="/static/img/coins/16/{{ path.hop_2.trade.buy_coin.local_fn }}" alt="{{ path.hop_2.trade.buy_coin.long_name }} logo">
                                                                    <span>{{ path.hop_2.trade.buy_coin.symbol }}</span>
                                                                    {% if path.hop_1.exchange.id != path.destination.exchange.id %}
                                                                        <i class="fas fa-arrow-right pl-1 pl-sm-2"></i>
                                                                    {% endif %}
                                                                {% else %}
                                                                    <i class="fas fa-arrow-right pl-1 pl-sm-2"></i>
                                                                {% endif %}
                                                            {% else %}
                                                                {% if path.hop_1.exchange.id != path.destination.exchange.id %}
                                                                    <i class="fas fa-arrow-right pl-1 pl-sm-2"></i>
                                                                {% endif %}
                                                            {% endif %}
                                                        </small>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- EXCHANGE 2 SUMMARY -->
                                    <div class="col-5 pl-3">
                                        {% if path.hop_2 and path.hop_1.exchange.id != path.hop_2.exchange.id %}
                                            <!-- Layout for XS to MD devices -->
                                            <div class="d-lg-none">
                                                <div class="d-flex justify-content-start align-items-center">
                                                    <img class="img-exchange-lg mr-1" src="/static/img/exchanges/64/{{ path.hop_2.exchange.img_fn }}" alt="{{ path.hop_2.exchange.name }} logo">
                                                    <a class="exchange-format" href="{{ path.hop_2.exchange.site_url }}" target="_blank" style="color: #212529">{{ path.hop_2.exchange.name }}</a>
                                                </div>
                                                <div class="d-flex align-items-center mt-3">
                                                    <small class="d-flex align-items-center dark-grey-color">
                                                        <img class="mr-1 img-coin" src="/static/img/coins/16/{{ path.hop_2.trade.sell_coin.local_fn }}" alt="{{ path.hop_2.trade.sell_coin.long_name }} logo">
                                                        <span>{{ path.hop_2.trade.sell_coin.symbol }}</span>
                                                        <i class="fas fa-exchange-alt mx-2"></i>
                                                        <img class="mr-1 img-coin" src="/static/img/coins/16/{{ path.hop_2.trade.buy_coin.local_fn }}" alt="{{ path.hop_2.trade.buy_coin.long_name }} logo">
                                                        <span>{{ path.hop_2.trade.buy_coin.symbol }}</span>
                                                        {% if path.hop_2.exchange.id != path.destination.exchange.id %}
                                                            <i class="fas fa-arrow-right pl-1 pl-sm-2"></i>
                                                        {% endif %}
                                                    </small>
                                                </div>
                                            </div>
                                            <!-- Layout for LG+ devices -->
                                            <div class="d-none d-lg-block">
                                                <div class="d-flex align-items-center">
                                                    <div class="ml-4">
                                                        <img class="img-exchange-lg" src="/static/img/exchanges/64/{{ path.hop_2.exchange.img_fn }}" alt="{{ path.hop_2.exchange.name }} logo">
                                                    </div>
                                                    <div class="ml-3">
                                                        <div>
                                                            <a class="exchange-format font-weight-bold" href="{{ path.hop_2.exchange.site_url }}" target="_blank" style="color: #212529">{{ path.hop_2.exchange.name }}</a>
                                                        </div>
                                                        <div class="d-flex align-items-center mt-2">
                                                            <small class="d-flex align-items-center dark-grey-color">
                                                                <img class="mr-1 img-coin" src="/static/img/coins/16/{{ path.hop_2.trade.sell_coin.local_fn }}" alt="{{ path.hop_2.trade.sell_coin.long_name }} logo">
                                                                <span>{{ path.hop_2.trade.sell_coin.symbol }}</span>
                                                                <i class="fas fa-exchange-alt mx-2"></i>
                                                                <img class="mr-1 img-coin" src="/static/img/coins/16/{{ path.hop_2.trade.buy_coin.local_fn }}" alt="{{ path.hop_2.trade.buy_coin.long_name }} logo">
                                                                <span>{{ path.hop_2.trade.buy_coin.symbol }}</span>
                                                                {% if path.hop_2.exchange.id != path.destination.exchange.id %}
                                                                    <i class="fas fa-arrow-right pl-1 pl-sm-2"></i>
                                                                {% endif %}
                                                            </small>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        {% endif %}
                                    </div>

                                    <!-- TOTAL COLUMN -->
                                    <div class="col-2 border-left">
                                        <div class="d-flex justify-content-center py-1 pt-lg-0">
                                            <span class="result-fees font-weight-bold">{{ path.get_total_fees(curr) }}</span>
                                        </div>
                                        <div class="d-flex justify-content-center mt-2 mt-lg-1">
                                            {% if path.hop_1.exchange.affiliate == 'Yes' %}
                                                <a class="referral-result-btn select-btn btn btn-deep-orange m-0" href="{{ path.hop_1.exchange.site_url }}" target="_blank" role="button" data-exch="{{ path.hop_1.exchange.name }}">Select</a>
                                            {% elif path.hop_2 and path.hop_2.exchange.affiliate == 'Yes' %}
                                                <a class="referral-result-btn select-btn btn btn-deep-orange m-0" href="{{ path.hop_2.exchange.site_url }}" target="_blank" role="button" data-exch="{{ path.hop_2.exchange.name }}">Select</a>
                                            {% else %}
                                                <a class="referral-result-btn select-btn btn btn-deep-orange m-0" href="{{ path.hop_1.exchange.site_url }}" target="_blank" role="button" data-exch="{{ path.hop_1.exchange.name }}">Select</a>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>




                                <!-- PROMO SECTION -->
                                <!-- Promotions section: Show promo if there is promo for Exchange 1 or 2. Display only once per exchange! -->
                                <!-- Look for promotions in Exchange 1 -->
                                {% if path.hop_1.exch_promo %}
                                    {% if path.hop_1.exchange.id not in promotions_displayed %}
                                        {% set promotions_displayed = promotions_displayed.append( path.hop_1.exchange.id ) %}
                                        <div class="d-flex justify-content-center mx-3">
                                            <div class="promo text-center">
                                                <span class="badge badge-dark mr-1">Promo</span><span class="text-dark font-italic smaller-font"> Use <a class="promo-link" href="{{ path.hop_1.exchange.site_url }}" target="_blank" data-exch="{{ path.hop_1.exchange.name }}">this link</a> {{ path.hop_1.exch_promo }}</span>
                                            </div>
                                        </div>
                                    {% endif %}
                                <!-- Look for promotions in Exchange 2 -->
                                {% elif path.hop_2 and path.hop_1.exchange.id != path.hop_2.exchange.id and path.hop_2.exch_promo %}
                                    {% if path.hop_2.exchange.id not in promotions_displayed %}
                                        {% set promotions_displayed = promotions_displayed.append( path.hop_2.exchange.id ) %}
                                        <div class="d-flex justify-content-center mx-3">
                                            <div class="promo text-center">
                                                <span class="badge badge-dark mr-1">Promo</span><span class="text-dark font-italic smaller-font"> Use <a class="promo-link" href="{{ path.hop_2.exchange.site_url }}" target="_blank" data-exch="{{ path.hop_2.exchange.name }}">this link</a> {{ path.hop_2.exch_promo }}</span>
                                            </div>
                                        </div>
                                    {% endif %}
                                {% endif %}
                                <!-- Collapse animation section -->
                                <div class="d-block d-flex align-items-center justify-content-between">
                                    <div class="pl-3 pl-lg-4 mt-2 pb-2">
                                        <!-- If it is the first iteration, open detail. Else leave it closed -->
                                        {% if loop.index == 1 %}
                                            <a id="path-fee-details-collapse" class="collapse-animation" data-toggle="collapse" href="#{{ path.id }}" role="button" aria-expanded="false" aria-controls="{{ path.id }}">
                                        {% else %}
                                            <a id="path-fee-details-collapse" class="collapse-animation" data-toggle="collapse" href="#{{ path.id }}" role="button" aria-expanded="false" aria-controls="{{ path.id }}">
                                        {% endif %}
                                            <div class="d-block d-flex align-items-center">
                                                <span>Path & fee details</span>
                                                <i class="fas fa-chevron-down ml-2"></i>
                                            </div>
                                        </a>
                                    </div>
                                </div>

                            </div>











                            <!-- COLLAPSED INFORMATION -->
                            <!-- If it is the first iteration, open detail. Otherwise, leave it closed -->
                            {% if loop.index == 1 %}
                            <div id="{{ path.id }}" class="collapse">
                            {% else %}
                            <div id="{{ path.id }}" class="collapse">
                            {% endif %}
                                <div class="card-body px-0 pt-2 pb-0">

                                    <!-- Detail Header -->
                                    <div class="row no-gutters smaller-font pt-1 mb-1">
                                        <div class="col-4">
                                            <div class="d-flex align-items-center justify-content-end">
                                                <span class="detail-header">Origin</span>
                                            </div>
                                        </div>
                                        <div class="col-4 offset-1 detail-dest-column">
                                            <div class="d-flex align-items-center justify-content-end">
                                                <span class="detail-header">Destination</span>
                                            </div>
                                        </div>
                                        <!-- Fees column -->
                                        <div class="col-3 detail-fee-column">
                                            <div class="d-flex justify-content-end">
                                                <span class="detail-header">Fees</span>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- 1st Steps: ORIGIN. If Origin != Exch.1, transfer from Origin to Exch1 -->
                                    {% if path.origin.exchange.id != path.hop_1.exchange.id %}
                                        <div class="row no-gutters smaller-font">
                                            <div class="col-1 d-flex align-items-center justify-content-end pr-1 pr-sm-2">
                                                <i class="fas fa-chevron-circle-right fa-lg orange-color"></i>
                                            </div>
                                            <div class="col-11 light-orange-bg">
                                                {% if path.origin.exchange.id == 'Wallet' %}
                                                    <span>Transfer your {{ path.origin.coin.symbol }} from your wallet to {{ path.hop_1.exchange.name }}</span>
                                                {% elif path.origin.exchange.id == 'Bank' %}
                                                    <span>Transfer your {{ path.origin.coin.symbol }} from your bank to {{ path.hop_1.exchange.name }}</span>
                                                {% else %}
                                                    <span>Transfer your {{ path.origin.coin.symbol }} from {{ path.origin.exchange.name }} to {{ path.hop_1.exchange.name }}</span>
                                                {% endif %}
                                                {% if (path.origin.exchange.id == 'Wallet') or (path.origin.exchange.id == 'Bank') %}
                                                    {% if path.hop_1.deposit_details == '' %}
                                                        <a class="no-link-tooltip text-right" data-toggle="tooltip" data-html="true" data-placement="top" title="Withdrawal fees may apply depending on the wallet or bank you use. Please, take them into account as well.</em>">
                                                            <i class="fas fa-info-circle"></i>
                                                        </a>
                                                    {% else %}
                                                        <a class="no-link-tooltip text-right" data-toggle="tooltip" data-html="true" data-placement="top" title="{{ path.hop_1.deposit_details }}<br>- - -</br><em>Withdrawal fees may apply depending on the wallet or bank you use. Please, take them into account as well.</em>">
                                                            <i class="fas fa-info-circle"></i>
                                                        </a>
                                                    {% endif %}
                                                {% else %}
                                                    <a class="no-link-tooltip text-right" data-toggle="tooltip" data-html="true" data-placement="top" title="{{ path.origin.withdraw_details }}<br>{{ path.hop_1.deposit_details }}">
                                                        <i class="fas fa-info-circle"></i>
                                                    </a>
                                                {% endif %}
                                            </div>
                                        </div>
                                        <div class="row no-gutters smaller-font pt-1 mb-3">
                                            <div class="col-4">
                                                <div class="d-flex align-items-center justify-content-end">
                                                    <img class="img-exchange-sm mr-1 mr-sm-2" src="/static/img/exchanges/64/{{ path.origin.exchange.img_fn }}" alt="{{ path.origin.exchange.name }} logo">
                                                    {% if path.origin.exchange.site_url != '' %}
                                                        <a class="referral-detail-link-2 font-weight-bold" href="{{ path.origin.exchange.site_url }}" target="_blank" role="button">{{ path.origin.exchange.name }}</a>
                                                    {% else %}
                                                        <span class="font-weight-bold">{{ path.origin.exchange.name }}</span>
                                                    {% endif %}
                                                </div>
                                                <div class="text-right">{{ path.origin.amount_str }}</div>
                                            </div>
                                            <div class="col-1 d-flex align-items-center justify-content-end">
                                                <i class="fas fa-plane"></i>
                                            </div>
                                            <div class="col-4 detail-dest-column">
                                                <div class="d-flex flex-column justify-content-end">
                                                    <div class="d-flex align-items-center justify-content-end">
                                                        <img class="img-exchange-sm mr-1 mr-sm-2" src="/static/img/exchanges/64/{{ path.hop_1.exchange.img_fn }}" alt="{{ path.hop_1.exchange.name }} logo">
                                                        <a class="referral-detail-link-3 font-weight-bold" href="{{ path.hop_1.exchange.site_url }}" target="_blank" role="button">{{ path.hop_1.exchange.name }}</a>
                                                    </div>
                                                    <div class="text-right">{{ path.hop_1.trade.sell_amt_str }}</div>
                                                </div>
                                            </div>
                                            <!-- Fees column -->
                                            <div class="col-3 border-left detail-fee-column">
                                                <div class="d-flex justify-content-end">
                                                    <span class="font-weight-bold">{{ path.calc_transfer_fees([path.origin.withdraw_fee, path.hop_1.deposit_fee], path.origin.coin.id) }}</span>
                                                </div>
                                                <div class="d-flex justify-content-end">
                                                    <span class="">{{ path.calc_transfer_fees([path.origin.withdraw_fee, path.hop_1.deposit_fee], path.origin.coin.id, True) }}</span>
                                                </div>
                                            </div>
                                        </div>
                                    {% endif %}

                                    <!-- # EXCHANGE 1 -->
                                    <!-- # 2nd Step: Trade Exch 1 -->
                                    <div class="row no-gutters smaller-font">
                                        <div class="col-1 d-flex align-items-center justify-content-end pr-1 pr-sm-2">
                                            <i class="fas fa-chevron-circle-right fa-lg orange-color"></i>
                                        </div>
                                        <div class="col-11 light-orange-bg">
                                            <span>In {{ path.hop_1.exchange.name }}, trade your {{ path.hop_1.trade.sell_coin.symbol }} for {{ path.hop_1.trade.buy_coin.symbol }}</span>
                                            <a class="no-link-tooltip text-right" data-toggle="tooltip" data-html="true" data-placement="top" title="{{ path.hop_1.trade_details }}">
                                                <i class="fas fa-info-circle"></i>
                                            </a>
                                        </div>
                                    </div>
                                    <div class="row no-gutters smaller-font pt-1 mb-3">
                                        <div class="col-4">
                                            <div class="d-flex flex-column justify-content-end">
                                                <div class="d-flex align-items-center justify-content-end">
                                                    <img class="img-exchange-sm mr-1 mr-sm-2" src="/static/img/exchanges/64/{{ path.hop_1.exchange.img_fn }}" alt="{{ path.hop_1.exchange.name }} logo">
                                                    <a class="referral-detail-link-2 font-weight-bold" href="{{ path.hop_1.exchange.site_url }}" target="_blank" role="button">{{ path.hop_1.exchange.name }}</a>
                                                </div>
                                                <span class="text-right">{{ path.hop_1.trade.sell_amt_str }}</span>
                                            </div>
                                        </div>
                                        <div class="col-1 d-flex align-items-center justify-content-end">
                                            <i class="fas fa-exchange-alt"></i>
                                        </div>
                                        <div class="col-4 detail-dest-column">
                                            <div class="d-flex flex-column justify-content-end">
                                                <div class="d-flex align-items-center justify-content-end">
                                                    <img class="img-exchange-sm mr-1 mr-sm-2" src="/static/img/exchanges/64/{{ path.hop_1.exchange.img_fn }}" alt="{{ path.hop_1.exchange.name }} logo">
                                                    <a class="referral-detail-link-3 font-weight-bold" href="{{ path.hop_1.exchange.site_url }}" target="_blank" role="button">{{ path.hop_1.exchange.name }}</a>
                                                </div>
                                                <span class="text-right">{{ path.hop_1.trade.buy_amt_str }}</span>
                                            </div>
                                        </div>
                                        <!-- Fees column -->
                                        <div class="col-3 border-left detail-fee-column">
                                            <div class="d-flex justify-content-end">
                                                <span class="mb-0 font-weight-bold text-right">{{ path.hop_1.trade.fee_amt_str }}</span>
                                            </div>
                                            <div class="d-flex justify-content-end">
                                                <span class="mb-0 text-right">{{ path.fee_to_currency(path.hop_1.trade.fee_amt, path.hop_1.trade.fee_coin.id) }}</span>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- # 3rd Step: Transfer from Exch1 to Exch2 / Destination / nowhere -->
                                    {% if (not path.hop_2 and path.hop_1.exchange.id != path.destination.exchange.id)
                                        or (path.hop_2 and path.hop_1.exchange.id != path.hop_2.exchange.id) %}
                                        {% if not path.hop_2 and path.hop_1.exchange.id != path.destination.exchange.id %}
                                            {% set step2b_dest = path.destination.exchange %}
                                            {% set step2b_dest_amt = path.destination.amount_str %}
                                        {% else %}
                                            {% set step2b_dest = path.hop_2.exchange %}
                                            {% set step2b_dest_amt = path.hop_2.trade.sell_amt_str %}
                                        {% endif %}
                                        <div class="row no-gutters smaller-font">
                                            <div class="col-1 d-flex align-items-center justify-content-end pr-1 pr-sm-2">
                                                <i class="fas fa-chevron-circle-right fa-lg orange-color"></i>
                                            </div>
                                            <div class="col-11 light-orange-bg">
                                                {% if step2b_dest.id == 'Wallet' %}
                                                    <span>Transfer your {{ path.hop_1.trade.buy_coin.symbol }} from {{ path.hop_1.exchange.name }} to your wallet</span>
                                                {% elif step2b_dest.id == 'Bank' %}
                                                    <span>Transfer your {{ path.hop_1.trade.buy_coin.symbol }} from {{ path.hop_1.exchange.name }} to your bank</span>
                                                {% else %}
                                                    <span>Transfer your {{ path.hop_1.trade.buy_coin.symbol }} from {{ path.hop_1.exchange.name }} to {{ step2b_dest.name }}</span>
                                                {% endif %}
                                                <a class="no-link-tooltip text-right" data-toggle="tooltip" data-html="true" data-placement="top" title="<p class='mb-1'>{{ path.hop_1.withdraw_details }}</p><p class='mb-1'>{{ path.hop_2.deposit_details }}</p>">
                                                    <i class="fas fa-info-circle"></i>
                                                </a>
                                            </div>
                                        </div>
                                        <div class="row no-gutters smaller-font pt-1 mb-3">
                                            <div class="col-4">
                                                <div class="d-flex flex-column justify-content-end">
                                                    <div class="d-flex align-items-center justify-content-end">
                                                        <img class="img-exchange-sm mr-1 mr-sm-2" src="/static/img/exchanges/64/{{ path.hop_1.exchange.img_fn }}" alt="{{ path.hop_1.exchange.name }} logo">
                                                        <a class="referral-detail-link-2 font-weight-bold" href="{{ path.hop_1.exchange.site_url }}" target="_blank" role="button">{{ path.hop_1.exchange.name }}</a>
                                                    </div>
                                                    <span class="text-right">{{ path.hop_1.trade.buy_amt_str }}</span>
                                                </div>
                                            </div>
                                            <div class="col-1 d-flex align-items-center justify-content-end">
                                                <i class="fas fa-plane"></i>
                                            </div>
                                            <div class="col-4 detail-dest-column">
                                                <div class="d-flex flex-column justify-content-end">
                                                    <div class="d-flex align-items-center justify-content-end">
                                                        <img class="img-exchange-sm mr-1 mr-sm-2" src="/static/img/exchanges/64/{{ step2b_dest.img_fn }}" alt="{{ step2b_dest.name }} logo">
                                                        {% if step2b_dest.site_url != '' %}
                                                            <a class="referral-detail-link-3 font-weight-bold" href="{{ step2b_dest.site_url }}" target="_blank" role="button">{{ step2b_dest.name }}</a>
                                                        {% else %}
                                                            <span class="font-weight-bold">{{ step2b_dest.name }}</span>
                                                        {% endif %}
                                                    </div>
                                                    <span class="text-right">{{ step2b_dest_amt }}</span>
                                                </div>
                                            </div>
                                            <!-- Fees column -->
                                            <div class="col-3 border-left detail-fee-column">
                                                <div class="d-flex justify-content-end">
                                                    <span class="mb-0 font-weight-bold text-right">{{ path.calc_transfer_fees([path.hop_1.withdraw_fee, path.hop_2.deposit_fee], path.hop_1.trade.buy_coin.symbol) }}</span>
                                                </div>
                                                <div class="d-flex justify-content-end">
                                                    <span class="mb-0 text-right">{{ path.calc_transfer_fees([path.hop_1.withdraw_fee, path.hop_2.deposit_fee], path.hop_1.trade.buy_coin.symbol, True) }}</span>
                                                </div>
                                            </div>
                                        </div>
                                    {% endif %}

                                    <!-- # EXCHANGE 2 -->
                                    <!-- # 4th Step: Trade in Exch 2. -->
                                    {% if path.hop_2 %}
                                        <div class="row no-gutters smaller-font">
                                            <div class="col-1 d-flex align-items-center justify-content-end pr-1 pr-sm-2">
                                                <i class="fas fa-chevron-circle-right fa-lg orange-color"></i>
                                            </div>
                                            <div class="col-11 light-orange-bg">
                                                <span>In {{ path.hop_2.exchange.name }}, trade your {{ path.hop_2.trade.sell_coin.symbol }} for {{ path.hop_2.trade.buy_coin.symbol }}</span>
                                                <a class="no-link-tooltip text-right" data-toggle="tooltip" data-html="true" data-placement="top" title="{{ path.hop_2.trade_details }}">
                                                    <i class="fas fa-info-circle"></i>
                                                </a>
                                            </div>
                                        </div>
                                        <div class="row no-gutters smaller-font pt-1 mb-3">
                                            <div class="col-4">
                                                <div class="d-flex flex-column justify-content-end">
                                                    <div class="d-flex align-items-center justify-content-end">
                                                        <img class="img-exchange-sm mr-1 mr-sm-2" src="/static/img/exchanges/64/{{ path.hop_2.exchange.img_fn }}" alt="{{ path.hop_2.exchange.name }} logo">
                                                        <a class="referral-detail-link-2 font-weight-bold" href="{{ path.hop_2.exchange.site_url }}" target="_blank" role="button">{{ path.hop_2.exchange.name }}</a>
                                                    </div>
                                                    <span class="text-right">{{ path.hop_2.trade.sell_amt_str }}</span>
                                                </div>
                                            </div>
                                            <div class="col-1 d-flex align-items-center justify-content-end">
                                                <i class="fas fa-exchange-alt"></i>
                                            </div>
                                            <div class="col-4 detail-dest-column">
                                                <div class="d-flex flex-column justify-content-end">
                                                    <div class="d-flex align-items-center justify-content-end">
                                                        <img class="img-exchange-sm mr-1 mr-sm-2" src="/static/img/exchanges/64/{{ path.hop_2.exchange.img_fn }}" alt="{{ path.hop_2.exchange.name }} logo">
                                                        <a class="referral-detail-link-3 font-weight-bold" href="{{ path.hop_2.exchange.site_url }}" target="_blank" role="button">{{ path.hop_2.exchange.name }}</a>
                                                    </div>
                                                    <span class="text-right">{{ path.hop_2.trade.buy_amt_str }}</span>
                                                </div>
                                            </div>
                                            <!-- Fees column -->
                                            <div class="col-3 border-left detail-fee-column">
                                                <div class="d-flex justify-content-end">
                                                    <span class="mb-0 font-weight-bold text-right">{{ path.hop_2.trade.fee_amt_str }}</span>
                                                </div>
                                                <div class="d-flex justify-content-end">
                                                    <span class="mb-0 text-right">{{ path.fee_to_currency(path.hop_2.trade.fee_amt, path.hop_2.trade.fee_coin.id) }}</span>
                                                </div>
                                            </div>
                                        </div>
                                    {% endif %}

                                    <!-- # 5th Step: Transfer from Exch2 to Destination (if it applies) -->
                                    {% if path.hop_2 and path.hop_2.exchange.id != path.destination.exchange.id %}
                                        <div class="row no-gutters smaller-font">
                                            <div class="col-1 d-flex align-items-center justify-content-end pr-1 pr-sm-2">
                                                <i class="fas fa-chevron-circle-right fa-lg orange-color"></i>
                                            </div>
                                            <div class="col-11 light-orange-bg">
                                                {% if path.destination.exchange.id == 'Wallet' %}
                                                    <span>Transfer your {{ path.hop_2.trade.buy_coin.symbol }} from {{ path.hop_2.exchange.name }} to your wallet</span>
                                                {% elif path.destination.exchange.id == 'Bank' %}
                                                    <span>Transfer your {{ path.hop_2.trade.buy_coin.symbol }} from {{ path.hop_2.exchange.name }} to your bank</span>
                                                {% else %}
                                                    <span>Transfer your {{ path.hop_2.trade.buy_coin.symbol }} from {{ path.hop_2.exchange.name }} to {{ path.destination.exchange.name }}</span>
                                                {% endif %}
                                                <a class="no-link-tooltip text-right" data-toggle="tooltip" data-html="true" data-placement="top" title="{{ path.hop_2.withdraw_details }}<br>{{ path.destination.deposit_details }}">
                                                    <i class="fas fa-info-circle"></i>
                                                </a>
                                            </div>
                                        </div>
                                        <div class="row no-gutters smaller-font pt-1 mb-3">
                                            <div class="col-4">
                                                <div class="d-flex flex-column justify-content-end">
                                                    <div class="d-flex align-items-center justify-content-end">
                                                        <img class="img-exchange-sm mr-1 mr-sm-2" src="/static/img/exchanges/64/{{ path.hop_2.exchange.img_fn }}" alt="{{ path.hop_2.exchange.name }} logo">
                                                        <a class="referral-detail-link-2 font-weight-bold" href="{{ path.hop_2.exchange.site_url }}" target="_blank" role="button">{{ path.hop_2.exchange.name }}</a>
                                                    </div>
                                                    <span class="text-right">{{ path.hop_2.trade.buy_amt_str }}</span>
                                                </div>
                                            </div>
                                            <div class="col-1 d-flex align-items-center justify-content-end">
                                                <i class="fas fa-plane"></i>
                                            </div>
                                            <div class="col-4 detail-dest-column">
                                                <div class="d-flex flex-column justify-content-end">
                                                    <div class="d-flex align-items-center justify-content-end">
                                                        <img class="img-exchange-sm mr-1 mr-sm-2" src="/static/img/exchanges/64/{{ path.destination.exchange.img_fn }}" alt="{{ path.destination.exchange.name }} logo">
                                                        {% if path.destination.exchange.site_url != '' %}
                                                            <a class="referral-detail-link-3 font-weight-bold" href="{{ path.destination.exchange.site_url }}" target="_blank" role="button">{{ path.destination.exchange.name }}</a>
                                                        {% else %}
                                                            <span class="font-weight-bold">{{ path.destination.exchange.name }}</span>
                                                        {% endif %}
                                                    </div>
                                                    <span class="text-right">{{ path.destination.amount_str }}</span>
                                                </div>
                                            </div>
                                            <!-- Fees column -->
                                            <div class="col-3 border-left detail-fee-column">
                                                <div class="d-flex justify-content-end">
                                                    <span class="mb-0 font-weight-bold text-right">{{ path.calc_transfer_fees([path.hop_2.withdraw_fee, path.destination.deposit_fee], path.hop_2.trade.buy_coin.symbol) }}</span>
                                                </div>
                                                <div class="d-flex justify-content-end">
                                                    <span class="mb-0 text-right">{{ path.calc_transfer_fees([path.hop_2.withdraw_fee, path.destination.deposit_fee], path.hop_2.trade.buy_coin.symbol, True) }}</span>
                                                </div>
                                            </div>
                                        </div>
                                    {% endif %}

                                </div>
                            </div>


                        </div>
                    {% endfor %}

                </div>
            </div>

        </div>

    </section>

    <section id="back-to-top-btn">
        <a id="myBtn" class="" href="#">
            <i class="fas fa-chevron-circle-up fa-3x"></i>
        </a>
    </section>

{% endblock main %}










{% block js %}
    <!-- typeahead -->
    <script type="text/javascript" src="{{ url_for('static', filename='js/bootstrap3-typeahead.min.js') }}"></script>
    <!-- Site styles -->
    <script type="text/javascript" src="{{ url_for('static', filename='js/main.js') }}"></script>
    <!-- Tests -->
    <!-- <script type="text/javascript" src="{{ url_for('static', filename='js/tests.js') }}"></script> -->
{% endblock %}
